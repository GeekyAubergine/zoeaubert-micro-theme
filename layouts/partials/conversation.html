{{ if .Site.Params.include_conversation }}
<script
  type="text/javascript"
  src="https://micro.blog/conversation.js?url={{ .Permalink }}"
></script>
{{ end }} {{ if templates.Exists "partials/conversation-link.html" }} {{ partial
"conversation-link.html" . }} {{ end }}

<div class="mt-8 mb-4" id="conversation-wrapper invisible">
  <a id="conversation-link" class=""
    ><span class="link">Conversation</span> on Micro.blog</a
  >
</div>

<script>
  const conversationLink = document.querySelector("#conversation-link");
  const conversationWrapper = document.querySelector("#conversation-wrapper");
  if (conversationLink && conversationWrapper) {
    const currentPageURLEncoded = encodeURIComponent("{{ .Permalink }}");

    console.log({ currentPageURLEncoded });

    fetch('https://micro.blog/conversation.js?format=jsonfeed&url=' + currentPageURLEncoded)
      .then((response) => response.json())
      .then((conversation) => {
        conversationLink.setAttribute("href", conversation.home_page_url);
        conversationLink.classList.remove("invisible");
      })
      .catch();
  }
</script>
